!function(){"use strict";var t=angular.module("xtForm",[]);t.directive("ngModel",["xtFormConfig","$rootScope","$interpolate","$document",function(t,r,e,n){var i="ng-untouched",o="ng-touched";return{require:["ngModel","^?xtForm","^?form"],link:function(a,u,l,s){function d(){g=p.$setTouched||m,$=b.getValidationStrategy(),p.$untouched=!0;var t=n[0].querySelectorAll('label[for="'+l.id+'"]');angular.extend(p,{$focused:!1,$label:t.length>0?t[0].innerText:"",$xtErrors:[]}),a.$watch(function(){return p.$error},f,!0),a.$on("XtForm.ForceErrorUpdate",f),u.on("focus",function(){p.$touched||g(),p.$focused=!0,f(),a.$apply()}).on("blur",function(){p.$focused=!1,f(),a.$apply()})}function c(t){var r="msg"+t[0].toUpperCase()+t.substring(1);return l[r]?l[r]:e(v[t])(l)}function f(){p.$xtErrors=[],angular.forEach(p.$error,function(t,r){var e=t&&$(h,p);if(e){var n={key:r,message:c(r)};"required"===r?p.$xtErrors.push(n):p.$xtErrors.unshift(n)}}),r.$broadcast("XtForm.ErrorsUpdated",p)}function m(){p.$touched=!0,p.$untouched=!1,u.addClass(o).removeClass(i)}var g,$,v=t.getErrorMessages(),p=s[0],b=s[1],h=s[2];b&&d()}}}]),t.directive("xtForm",["$timeout",function(t){return{require:"",priority:-1,controller:"XtFormController",controllerAs:"xtForm",link:function(r,e,n,i){e.on("submit",function(){r.$apply(function(){i.submit()})}).on("reset",function(){t(function(){i.reset()})})}}}]).controller("XtFormController",["$scope","$element","$attrs","xtFormConfig","$window",function(t,r,e,n,i){function o(){return angular.isFunction(l.$setSubmitted)?void l.$setSubmitted():(l.$submitted=!0,void r.addClass("ng-submitted"))}function a(){angular.isFunction(l.$setSubmitted)||(l.$submitted=!1,r.removeClass("ng-submitted"))}var u=this,l=r.controller("form"),s=e.strategy?n.getValidationStrategy(e.strategy):n.getDefaultValidationStrategy();angular.extend(u,{form:l,getValidationStrategy:function(){return s},tooltipTrigger:e.tooltipTrigger,submit:function(){o(),l.$invalid&&e.focusError&&i.setTimeout(function(){r.find(".ng-invalid:input:visible:first").focus()}),t.$broadcast("XtForm.ForceErrorUpdate",null,"submit")},reset:function(){u.form.$setPristine(),u.form.$setUntouched(),a(),t.$broadcast("XtForm.ForceErrorUpdate",null,"reset")}})}]),t.provider("xtFormConfig",function(){var t,r=this,e={minlength:"Needs to be at least {{ngMinlength}} characters long",maxlength:"Can be no longer than {{ngMaxlength}} characters long",required:"This field is required",number:"Must be a number",min:"Must be at least {{min}}",max:"Must be no greater than {{max}}",email:"Must be a valid E-mail address",pattern:"Illegal value",url:"Must be a valid URL",date:"Must be a valid date",datetimelocal:"Must be a valid date",time:"Must be a valid time",week:"Must be a valid week",month:"Must be a valid month",$$server:"An error has occurred"};angular.extend(r,{$validationStrategies:{invalid:function(t){return t.$invalid},submitted:function(t){return t.$invalid&&t.$submitted},dirty:function(t,r){return r.$invalid&&r.$dirty},dirtyOrSubmitted:function(t,r){return r.$invalid&&(t.$submitted||r.$dirty)},focusedAndDirtyOrSubmitted:function(t,r){return r.$invalid&&r.$focused&&(r.$dirty||t.$submitted)},dirtyAndFocusedOrSubmitted:function(t,r){return r.$invalid&&(t.$submitted||r.$dirty&&r.$focused)}},addValidationStrategy:function(t,e){r.$validationStrategies[t]=e},setDefaultValidationStrategy:function(e){if(!r.$validationStrategies[e])throw new Error("Could not find validation strategy by name: "+e);t=r.$validationStrategies[e]},setErrorMessages:function(t){angular.extend(e,t)}}),this.$get=function(){return{getErrorMessages:function(){return angular.copy(e)},getValidationStrategy:function(t){if(!r.$validationStrategies[t])throw new Error("Could not find validation strategy by name: "+t);return r.$validationStrategies[t]},getDefaultValidationStrategy:function(){return t}}},r.setDefaultValidationStrategy("dirtyOrSubmitted")}),t.directive("xtValidationInline",["$templateCache",function(t){function r(){return"validation_"+e++}var e=0;return{require:["^xtForm"],restrict:"EA",scope:!0,replace:!0,template:function(r,e){return t.get(e.templateUrl||"xtForm/inline/validationInline.html")},link:function(t,e,n){function i(){e.addClass("xt-validation-inline"),n.id||(n.id=r(),e.attr("id",n.id)),l.attr("required")&&l.attr("aria-required",!0),t.$on("XtForm.ErrorsUpdated",function(t,r){(null===r||r===s)&&o()})}function o(){var r=n.multiple?s.$xtErrors.length:1;t.errors=s.$xtErrors.slice(0,r),t.showErrors=t.errors.length>0,a(t.showErrors)}function a(t){t?l.attr("aria-invalid",!0).attr("aria-describedby",n.id):(l.removeAttr("aria-invalid"),l.removeAttr("aria-describedby"))}var u=n["for"]||n.xtValidationInline;if(angular.isUndefined(u))throw new Error('The validation input id must be specified eg. for="id"');var l=angular.element(document.getElementById(u));if(0===l.length)throw new Error("Can not find input element for the validation directive");var s=l.controller("ngModel");i()}}}]),t.directive("xtValidationSummary",["$templateCache",function(t){return{require:["^xtForm","^form"],restrict:"EA",replace:!0,scope:!0,template:function(r,e){return t.get(e.templateUrl||"xtForm/summary/validationSummary.html")},link:function(t,r,e,n){function i(){t.errors=[],angular.forEach(o,function(r,n){if("$"!==n[0]){var i=e.multiple?r.$xtErrors.length:1,o=r.$xtErrors.slice(0,i);angular.forEach(o,function(e){t.errors.push({key:e.key,label:r.$label,message:e.message})})}}),t.showErrors=t.errors.length>0}var o=n[1];t.showLabel="true"===e.showLabel||angular.isUndefined(e.showLabel),t.$on("XtForm.ErrorsUpdated",i)}}}]),t.directive("xtValidationTooltip",["$compile","xtFormConfig","$interpolate",function(t,r,e){return{require:["^xtForm","^ngModel"],restrict:"EA",link:function(n,i,o,a){function u(){l(),s()}function l(){var t=o["for"]||o.xtValidationTooltip;f=t?angular.element(document.getElementById(t)):i,f.addClass("xt-validation-tooltip"),f.attr("required")&&f.attr("aria-required",!0)}function s(){var r="!"+m.form.$name+"."+f.attr("name"),e=r+".$error",a=d().map(function(t){return"("+e+"."+t.key+'?"":"'+t.message+'.  ")'}).join(" + ");i.addClass("xt-error-container"),i.attr("tooltip-placement","top"),i.attr("tooltip","{{"+a+"}}"),i.attr("tooltip-trigger","mouseenter"),i.attr("tooltip-class","xtClass"),i.attr("tooltip-enable",r+".$valid"),i.removeAttr(o.$attr.xtValidationTooltip),t(i)(n)}function d(){var t=[];return angular.forEach(o,function(r,e){var n=e;if(0===e.indexOf("ng")?n=e.substring(2):"type"===e.toLowerCase()&&(n=r.toLowerCase()),n in g){var i={key:n,message:c(n)};t.push(i)}}),t}function c(t){var r="msg"+t[0].toUpperCase()+t.substring(1);return o[r]?o[r]:e(g[t])(o)}var f,m=a[0],g=r.getErrorMessages();u()}}}])}();